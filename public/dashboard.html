<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Admin Dashboard</h1>
<div id="tickets"></div>

<script>
async function loadTickets() {
  const res = await fetch('/api/tickets');
  const tickets = await res.json();
  const container = document.getElementById('tickets');
  container.innerHTML = '';
  tickets.forEach((t, idx) => {
    const div = document.createElement('div');
    div.className = 'ticket';
    div.innerHTML = `
      <h3>Ticket #${t.ticketNumber} (${t.status})</h3>
      <ul>${t.items.map((i, ii) => `<li>${i.name}: ${i.description} <button onclick="addComment(${idx},${ii})">Comment</button></li>`).join('')}</ul>
      <button onclick="updateStatus('${t.ticketId}','Located')">Located</button>
      <button onclick="updateStatus('${t.ticketId}','Searching')">Searching</button>
      <button onclick="deleteTicket('${t.ticketId}')">Delete</button>
    `;
    container.appendChild(div);
  });
}

async function updateStatus(id, status) {
  await fetch(`/api/tickets/${id}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ status })
  });
  loadTickets();
}

async function deleteTicket(id) {
  await fetch(`/api/tickets/${id}`, { method: 'DELETE' });
  loadTickets();
}

function addComment(ticketIndex, itemIndex) {
  const comment = prompt('Enter comment:');
  if (!comment) return;
  fetch(`/api/tickets/${ticketIndex}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ comment, itemIndex })
  }).then(loadTickets);
}

setInterval(loadTickets, 5000); // auto-refresh
loadTickets();
</script>
</body>
</html>

const ticketsContainer = document.getElementById("ticketsContainer");

async function loadTickets() {
  const res = await fetch("/api/tickets");
  const tickets = await res.json();

  ticketsContainer.innerHTML = "";
  tickets.forEach(t => {
    const div = document.createElement("div");
    div.classList.add("ticket");
    div.innerHTML = `
      <h3>#${t.number} - ${t.name}</h3>
      <p>Status: ${t.status}</p>
      <ul>${t.items.map(i => `<li>${i.name}: ${i.desc}</li>`).join("")}</ul>
      <input type="text" placeholder="Add comment" class="commentInput"/>
      <button class="updateBtn">Update</button>
      <button class="deleteBtn">Delete</button>
    `;

    div.querySelector(".updateBtn").addEventListener("click", async () => {
      const comment = div.querySelector(".commentInput").value;
      const status = prompt("Enter new status", t.status);
      await fetch(`/api/tickets/${t.id}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status, comments: comment })
      });
      loadTickets();
    });

    div.querySelector(".deleteBtn").addEventListener("click", async () => {
      if (!confirm("Delete this ticket?")) return;
      await fetch(`/api/tickets/${t.id}`, { method: "DELETE" });
      loadTickets();
    });

    ticketsContainer.appendChild(div);
  });
}

// Auto refresh every 5s
setInterval(loadTickets, 5000);
loadTickets();
